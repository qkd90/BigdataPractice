(function (e) {
    var h, i, b = {}, f = 0, g = {css: [], js: []}, m = document.styleSheets;

    function l(p, o) {
        var q = document.createElement(p), n = null;
        for (n in o) {
            if (o.hasOwnProperty(n)) {
                q.setAttribute(n, o[n])
            }
        }
        return q
    }

    function j(n) {
        var q = b[n], r, o;
        if (q) {
            r = q.callback;
            o = q.urls;
            o.shift();
            f = 0;
            if (!o.length) {
                r && r.call(q.context, q.obj);
                b[n] = null;
                g[n].length && k(n)
            }
        }
    }

    function c() {
        var n = navigator.userAgent;
        h = {async: document.createElement("script").async === true};
        (h.webkit = /AppleWebKit\//.test(n)) || (h.ie = /MSIE/.test(n)) || (h.opera = /Opera/.test(n)) || (h.gecko = /Gecko\//.test(n)) || (h.unknown = true)
    }

    function k(z, y, A, v, r) {
        var t = function () {
            j(z)
        }, B = z === "css", o = [], u, w, s, q, x, n;
        h || c();
        if (y) {
            y = typeof y === "string" ? [y] : y.concat();
            if (B || h.async || h.gecko || h.opera) {
                g[z].push({urls: y, callback: A, obj: v, context: r})
            } else {
                for (u = 0, w = y.length; u < w; ++u) {
                    g[z].push({urls: [y[u]], callback: u === w - 1 ? A : null, obj: v, context: r})
                }
            }
        }
        if (b[z] || !(q = b[z] = g[z].shift())) {
            return
        }
        i || (i = document.head || document.getElementsByTagName("head")[0]);
        x = q.urls;
        for (u = 0, w = x.length; u < w; ++u) {
            n = x[u];
            if (B) {
                s = h.gecko ? l("style") : l("link", {type: "text/css", rel: "stylesheet", href: n})
            } else {
                s = l("script", {type: "text/javascript", src: n});
                s.async = false
            }
            if (h.ie && !B) {
                s.onreadystatechange = function () {
                    if (!s.readyState || (/loaded|complete/).test(s.readyState)) {
                        s.onreadystatechange = null;
                        t()
                    }
                }
            } else {
                if (B && (h.gecko || h.webkit)) {
                    if (h.webkit) {
                        q.urls[u] = s.href;
                        d()
                    } else {
                        s.innerHTML = '@import "' + n + '";';
                        a(s)
                    }
                } else {
                    s.onload = s.onerror = t
                }
            }
            q.obj = s;
            o.push(s)
        }
        for (u = 0, w = o.length; u < w; ++u) {
            i.appendChild(o[u])
        }
    }

    function a(p) {
        var o;
        try {
            o = !!p.sheet.cssRules
        } catch (n) {
            f += 1;
            if (f < 200) {
                setTimeout(function () {
                    a(p)
                }, 50)
            } else {
                o && j("css")
            }
            return
        }
        j("css")
    }

    function d() {
        var o = b.css, n;
        if (o) {
            n = m.length;
            var p = new RegExp(o.urls[0] + "$");
            while (--n >= 0) {
                if (p.test(m[n].href)) {
                    j("css");
                    break
                }
            }
            f += 1;
            if (o) {
                if (f < 200) {
                    setTimeout(d, 50)
                } else {
                    j("css")
                }
            }
        }
    }

    e.ResourceLoader = function (w, y, x, r, n) {
        var p = {onlyOnce: true,};
        var s = this, o = [], v = [];
        s.settings = e.extend({}, p, y);
        if (y && typeof y === "function") {
            x = y
        }
        for (var q = 0; q < w.length; q++) {
            var u = true;
            var t = new RegExp(w[q] + "$");
            if (/\.js$/i.test(w[q])) {
                jQuery("head script").each(function (z, A) {
                    if (s.settings.onlyOnce && t.test(e(A.outerHTML).prop("src"))) {
                        u = false;
                        return u
                    }
                });
                if (u) {
                    v.push(w[q])
                }
            } else {
                if (/\.css$/i.test(w[q])) {
                    jQuery("head link").each(function (z, A) {
                        if (s.settings.onlyOnce && t.test(e(A.outerHTML).prop("href"))) {
                            u = false;
                            return u
                        }
                    });
                    if (u) {
                        o.push(w[q])
                    }
                }
            }
        }
        if (o.length > 0) {
            k("css", o, x, r, n)
        }
        if (v.length > 0) {
            k("js", v, x, r, n)
        }
        if (v.length == 0 && o.length == 0 && x) {
            x.call()
        }
        return {
            css: function (B, C, A, z) {
                k("css", B, C, A, z)
            }, js: function (B, C, A, z) {
                k("js", B, C, A, z)
            }
        }
    }
})(jQuery);