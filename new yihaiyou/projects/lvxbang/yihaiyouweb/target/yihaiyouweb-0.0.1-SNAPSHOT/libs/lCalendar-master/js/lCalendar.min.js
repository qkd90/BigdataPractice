window.lCalendar=function(){var e=function(){this.gearDate,this.minY=1900,this.minM=1,this.minD=1,this.maxY=2099,this.maxM=12,this.maxD=31};return e.prototype={init:function(e){if(this.type=e.type,this.trigger=document.querySelector(e.trigger),null!=this.trigger.getAttribute("data-lcalendar")){var t=this.trigger.getAttribute("data-lcalendar").split(","),a=t[0].split("-");this.minY=~~a[0],this.minM=~~a[1],this.minD=~~a[2];var r=t[1].split("-");this.maxY=~~r[0],this.maxM=~~r[1],this.maxD=~~r[2]}this.bindEvent(this.type)},bindEvent:function(e){function t(){p.gearDate=document.createElement("div"),p.gearDate.className="gearDate",p.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="date_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div></div></div></div>',document.body.appendChild(p.gearDate),a();var e=p.gearDate.querySelector(".lcalendar_cancel");e.addEventListener("touchstart",h);var t=p.gearDate.querySelector(".lcalendar_finish");t.addEventListener("touchstart",_);var r=p.gearDate.querySelector(".date_yy"),d=p.gearDate.querySelector(".date_mm"),i=p.gearDate.querySelector(".date_dd");r.addEventListener("touchstart",c),d.addEventListener("touchstart",c),i.addEventListener("touchstart",c),r.addEventListener("touchmove",o),d.addEventListener("touchmove",o),i.addEventListener("touchmove",o),r.addEventListener("touchend",m),d.addEventListener("touchend",m),i.addEventListener("touchend",m)}function a(){var e=new Date,t={yy:e.getYear(),mm:e.getMonth(),dd:e.getDate()-1};/^\d{4}-\d{1,2}-\d{1,2}$/.test(p.trigger.value)?(rs=p.trigger.value.match(/(^|-)\d{1,4}/g),t.yy=rs[0]-p.minY,t.mm=rs[1].replace(/-/g,"")-1,t.dd=rs[2].replace(/-/g,"")-1):t.yy=t.yy+1900-p.minY,p.gearDate.querySelector(".date_yy").setAttribute("val",t.yy),p.gearDate.querySelector(".date_mm").setAttribute("val",t.mm),p.gearDate.querySelector(".date_dd").setAttribute("val",t.dd),s()}function r(){p.gearDate=document.createElement("div"),p.gearDate.className="gearDatetime",p.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="datetime_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>',document.body.appendChild(p.gearDate),d();var e=p.gearDate.querySelector(".lcalendar_cancel");e.addEventListener("touchstart",h);var t=p.gearDate.querySelector(".lcalendar_finish");t.addEventListener("touchstart",y);var a=p.gearDate.querySelector(".date_yy"),r=p.gearDate.querySelector(".date_mm"),i=p.gearDate.querySelector(".date_dd"),n=p.gearDate.querySelector(".time_hh"),s=p.gearDate.querySelector(".time_mm");a.addEventListener("touchstart",c),r.addEventListener("touchstart",c),i.addEventListener("touchstart",c),n.addEventListener("touchstart",c),s.addEventListener("touchstart",c),a.addEventListener("touchmove",o),r.addEventListener("touchmove",o),i.addEventListener("touchmove",o),n.addEventListener("touchmove",o),s.addEventListener("touchmove",o),a.addEventListener("touchend",m),r.addEventListener("touchend",m),i.addEventListener("touchend",m),n.addEventListener("touchend",m),s.addEventListener("touchend",m)}function d(){var e=new Date,t={yy:e.getYear(),mm:e.getMonth(),dd:e.getDate()-1,hh:e.getHours(),mi:e.getMinutes()};/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(p.trigger.value)?(rs=p.trigger.value.match(/(^|-|\s|:)\d{1,4}/g),t.yy=rs[0]-p.minY,t.mm=rs[1].replace(/-/g,"")-1,t.dd=rs[2].replace(/-/g,"")-1,t.hh=parseInt(rs[3].replace(/\s0?/g,"")),t.mi=parseInt(rs[4].replace(/:0?/g,""))):t.yy=t.yy+1900-p.minY,p.gearDate.querySelector(".date_yy").setAttribute("val",t.yy),p.gearDate.querySelector(".date_mm").setAttribute("val",t.mm),p.gearDate.querySelector(".date_dd").setAttribute("val",t.dd),s(),p.gearDate.querySelector(".time_hh").setAttribute("val",t.hh),p.gearDate.querySelector(".time_mm").setAttribute("val",t.mi),v()}function i(){p.gearDate=document.createElement("div"),p.gearDate.className="gearDate",p.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="time_roll"><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>',document.body.appendChild(p.gearDate),n();var e=p.gearDate.querySelector(".lcalendar_cancel");e.addEventListener("touchstart",h);var t=p.gearDate.querySelector(".lcalendar_finish");t.addEventListener("touchstart",b);var a=p.gearDate.querySelector(".time_hh"),r=p.gearDate.querySelector(".time_mm");a.addEventListener("touchstart",c),r.addEventListener("touchstart",c),a.addEventListener("touchmove",o),r.addEventListener("touchmove",o),a.addEventListener("touchend",m),r.addEventListener("touchend",m)}function n(){var e=new Date,t={hh:e.getHours(),mm:e.getMinutes()};/^\d{2}:\d{2}$/.test(p.trigger.value)&&(rs=p.trigger.value.match(/(^|:)\d{2}/g),t.hh=parseInt(rs[0].replace(/^0?/g,"")),t.mm=parseInt(rs[1].replace(/:0?/g,""))),p.gearDate.querySelector(".time_hh").setAttribute("val",t.hh),p.gearDate.querySelector(".time_mm").setAttribute("val",t.mm),v()}function s(){var e=p.maxY-p.minY+1,t=p.gearDate.querySelector(".date_yy"),a="";if(t&&t.getAttribute("val")){for(var r=parseInt(t.getAttribute("val")),d=0;e-1>=d;d++)a+="<div class='tooth'>"+(p.minY+d)+"</div>";t.innerHTML=a;var i=Math.floor(parseFloat(t.getAttribute("top")));if(isNaN(i))t.style["-webkit-transform"]="translate3d(0,"+(8-2*r)+"em,0)",t.setAttribute("top",8-2*r+"em");else{i%2==0?i=i:i+=1,i>8&&(i=8);var n=8-2*(e-1);n>i&&(i=n),t.style["-webkit-transform"]="translate3d(0,"+i+"em,0)",t.setAttribute("top",i+"em"),r=Math.abs(i-8)/2,t.setAttribute("val",r)}var s=p.gearDate.querySelector(".date_mm");if(s&&s.getAttribute("val")){a="";var v=parseInt(s.getAttribute("val")),c=11,o=0;r==e-1&&(c=p.maxM-1),0==r&&(o=p.minM-1);for(var d=0;c-o+1>d;d++)a+="<div class='tooth'>"+(o+d+1)+"</div>";s.innerHTML=a,v>c?(v=c,s.setAttribute("val",v)):o>v&&(v=c,s.setAttribute("val",v)),s.style["-webkit-transform"]="translate3d(0,"+(8-2*(v-o))+"em,0)",s.setAttribute("top",8-2*(v-o)+"em");var m=p.gearDate.querySelector(".date_dd");if(m&&m.getAttribute("val")){a="";var u=parseInt(m.getAttribute("val")),g=l(r,v),h=g-1,_=0;r==e-1&&p.maxM==v+1&&(h=p.maxD-1),0==r&&p.minM==v+1&&(_=p.minD-1);for(var d=0;h-_+1>d;d++)a+="<div class='tooth'>"+(_+d+1)+"</div>";m.innerHTML=a,u>h?(u=h,m.setAttribute("val",u)):_>u&&(u=_,m.setAttribute("val",u)),m.style["-webkit-transform"]="translate3d(0,"+(8-2*(u-_))+"em,0)",m.setAttribute("top",8-2*(u-_)+"em")}}}}function v(){var e=p.gearDate.querySelector(".time_hh");if(e&&e.getAttribute("val")){for(var t="",a=parseInt(e.getAttribute("val")),r=0;23>=r;r++)t+="<div class='tooth'>"+r+"</div>";e.innerHTML=t,e.style["-webkit-transform"]="translate3d(0,"+(8-2*a)+"em,0)",e.setAttribute("top",8-2*a+"em");var d=p.gearDate.querySelector(".time_mm");if(d&&d.getAttribute("val")){for(var t="",i=parseInt(d.getAttribute("val")),r=0;59>=r;r++)t+="<div class='tooth'>"+r+"</div>";d.innerHTML=t,d.style["-webkit-transform"]="translate3d(0,"+(8-2*i)+"em,0)",d.setAttribute("top",8-2*i+"em")}}}function l(e,t){return 1==t?(e+=p.minY,e%4==0&&e%100!=0||e%400==0&&e%4e3!=0?29:28):3==t||5==t||8==t||10==t?30:31}function c(e){e.preventDefault();for(var t=e.target;!t.classList.contains("gear");)t=t.parentElement;clearInterval(t["int_"+t.id]),t["old_"+t.id]=e.targetTouches[0].screenY,t["o_t_"+t.id]=(new Date).getTime();var a=t.getAttribute("top");t["o_d_"+t.id]=a?parseFloat(a.replace(/em/g,"")):0}function o(e){e.preventDefault();for(var t=e.target;!t.classList.contains("gear");)t=t.parentElement;t["new_"+t.id]=e.targetTouches[0].screenY,t["n_t_"+t.id]=(new Date).getTime();var a=18*(t["new_"+t.id]-t["old_"+t.id])/370;t["pos_"+t.id]=t["o_d_"+t.id]+a,t.style["-webkit-transform"]="translate3d(0,"+t["pos_"+t.id]+"em,0)",t.setAttribute("top",t["pos_"+t.id]+"em")}function m(e){e.preventDefault();for(var t=e.target;!t.classList.contains("gear");)t=t.parentElement;var a=(t["new_"+t.id]-t["old_"+t.id])/(t["n_t_"+t.id]-t["o_t_"+t.id]);t["spd_"+t.id]=Math.abs(a)<=.2?0>a?-.08:.08:Math.abs(a)<=.5?0>a?-.16:.16:a/2,t["pos_"+t.id]||(t["pos_"+t.id]=0),u(t)}function u(e){var t=0,a=!1,r=p.maxY-p.minY+1;clearInterval(e["int_"+e.id]),e["int_"+e.id]=setInterval(function(){var d=e["pos_"+e.id],i=e["spd_"+e.id]*Math.exp(-.03*t);if(d+=i,Math.abs(i)>.1);else{i=.1;var n=2*Math.round(d/2);Math.abs(d-n)<.02?a=!0:d>n?d-=i:d+=i}switch(d>8&&(d=8,a=!0),e.dataset.datetype){case"date_yy":var s=8-2*(r-1);if(s>d&&(d=s,a=!0),a){var v=Math.abs(d-8)/2;g(e,v),clearInterval(e["int_"+e.id])}break;case"date_mm":var c=p.gearDate.querySelector(".date_yy"),o=parseInt(c.getAttribute("val")),m=11,u=0;o==r-1&&(m=p.maxM-1),0==o&&(u=p.minM-1);var s=8-2*(m-u);if(s>d&&(d=s,a=!0),a){var v=Math.abs(d-8)/2+u;g(e,v),clearInterval(e["int_"+e.id])}break;case"date_dd":var c=p.gearDate.querySelector(".date_yy"),h=p.gearDate.querySelector(".date_mm"),o=parseInt(c.getAttribute("val")),_=parseInt(h.getAttribute("val")),y=l(o,_),b=y-1,D=0;o==r-1&&p.maxM==_+1&&(b=p.maxD-1),0==o&&p.minM==_+1&&(D=p.minD-1);var s=8-2*(b-D);if(s>d&&(d=s,a=!0),a){var v=Math.abs(d-8)/2+D;g(e,v),clearInterval(e["int_"+e.id])}break;case"time_hh":if(-38>d&&(d=-38,a=!0),a){var v=Math.abs(d-8)/2;g(e,v),clearInterval(e["int_"+e.id])}break;case"time_mm":if(-110>d&&(d=-110,a=!0),a){var v=Math.abs(d-8)/2;g(e,v),clearInterval(e["int_"+e.id])}}e["pos_"+e.id]=d,e.style["-webkit-transform"]="translate3d(0,"+d+"em,0)",e.setAttribute("top",d+"em"),t++},30)}function g(e,t){t=Math.round(t),e.setAttribute("val",t),/date/.test(e.dataset.datetype)?s():v()}function h(e){e.preventDefault();var t=new CustomEvent("input");p.trigger.dispatchEvent(t),document.body.removeChild(p.gearDate)}function _(e){var t=p.maxY-p.minY+1,a=parseInt(Math.round(p.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(p.gearDate.querySelector(".date_mm").getAttribute("val")))+1;r=r>9?r:"0"+r;var d=parseInt(Math.round(p.gearDate.querySelector(".date_dd").getAttribute("val")))+1;d=d>9?d:"0"+d,p.trigger.value=a%t+p.minY+"-"+r+"-"+d,h(e)}function y(e){var t=p.maxY-p.minY+1,a=parseInt(Math.round(p.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(p.gearDate.querySelector(".date_mm").getAttribute("val")))+1;r=r>9?r:"0"+r;var d=parseInt(Math.round(p.gearDate.querySelector(".date_dd").getAttribute("val")))+1;d=d>9?d:"0"+d;var i=parseInt(Math.round(p.gearDate.querySelector(".time_hh").getAttribute("val")));i=i>9?i:"0"+i;var n=parseInt(Math.round(p.gearDate.querySelector(".time_mm").getAttribute("val")));n=n>9?n:"0"+n,p.trigger.value=a%t+p.minY+"-"+r+"-"+d+" "+(i.length<2?"0":"")+i+(n.length<2?":0":":")+n,h(e)}function b(e){var t=parseInt(Math.round(p.gearDate.querySelector(".time_hh").getAttribute("val")));t=t>9?t:"0"+t;var a=parseInt(Math.round(p.gearDate.querySelector(".time_mm").getAttribute("val")));a=a>9?a:"0"+a,p.trigger.value=(t.length<2?"0":"")+t+(a.length<2?":0":":")+a,h(e)}var p=this;p.trigger.addEventListener("click",{date:t,datetime:r,time:i}[e])}},e}();